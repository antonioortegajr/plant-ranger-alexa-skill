# Plant Ranger Check - Alexa Skill ğŸŒ±

A comprehensive Alexa skill that allows users to check their plant health status by integrating with the Plant Ranger API using OAuth 2.0 authentication.

This IS NOT an offcial skill for Plant Ranger.
This work is my own and not assioated in an offcial way with the Plant Rnager product and service. Nor it's parent compay. DO NOT contact the company about this repo or skill.

Offcial site: https://www.plantranger.com/

## âš ï¸ DISCLAIMER: CURSOR SLOP ZONE ğŸš¨

**ğŸ¤– This entire repository is 100% "Cursor Slop" - generated by AI with minimal human intervention! ğŸ¤–**

- ğŸ­ **What you see here**: Professional-looking code that might actually work
- ğŸª **Reality**: Pure AI-generated chaos wrapped in TypeScript
- ğŸ¨ **Quality**: Somewhere between "it compiles" and "why is there a llama in my plant health API?"
- ğŸ¯ **Use at your own risk**: This code has never met a real plant (or a real user)
- ğŸª **Guarantee**: Absolutely none. Zero. Zilch. Nada. ğŸ­

*Made with ğŸ’š, â˜•, and way too much confidence by Cursor AI*

## ğŸŒ± Features

- **Plant Health Monitoring**: Check the health status of your plants
- **OAuth 2.0 Integration**: Secure authentication with Plant Ranger API
- **AWS CDK Deployment**: Infrastructure as code for easy deployment
- **Lambda Functions**: Serverless architecture for scalability
- **DynamoDB Storage**: Secure token storage and management

## ğŸ—ï¸ Architecture

```
User â†’ Alexa Device â†’ Lambda (Alexa Handler) â†’ Plant Ranger API
                    â†“
                DynamoDB (OAuth Tokens)
                    â†“
                Secrets Manager (Credentials)
```

## ğŸ“ Project Structure

```
plant-ranger-alexa-skill/
â”œâ”€â”€ cdk/                          # AWS CDK infrastructure
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â””â”€â”€ plant-ranger-stack.ts # Main CDK stack
â”‚   â”œâ”€â”€ bin/
â”‚   â”‚   â””â”€â”€ app.ts               # CDK app entry point
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ lambda/                       # Lambda functions
â”‚   â”œâ”€â”€ alexa-handler.ts         # Main Alexa skill handler
â”‚   â”œâ”€â”€ oauth-handler.ts         # OAuth flow handler
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ oauth.ts             # OAuth management utilities
â”‚   â”‚   â””â”€â”€ api-client.ts        # Plant Ranger API client
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ skill-package/               # ASK CLI skill package
â”‚   â”œâ”€â”€ skill.json               # Skill manifest
â”‚   â””â”€â”€ interactionModels/
â”‚       â””â”€â”€ custom/
â”‚           â””â”€â”€ en-US.json       # Interaction model
â”œâ”€â”€ alexa-skill/                 # Original skill files (backup)
â”‚   â”œâ”€â”€ skill.json               
â”‚   â”œâ”€â”€ models/
â”‚   â”‚   â””â”€â”€ en-US.json           
â”‚   â””â”€â”€ utterances/
â”‚       â””â”€â”€ en-US.txt            
â”œâ”€â”€ ask-resources.json           # ASK CLI configuration
â”œâ”€â”€ ask-deploy.sh                # ASK CLI deployment script
â”œâ”€â”€ deploy.sh                    # CDK deployment script
â””â”€â”€ README.md
```

## ğŸš€ Quick Start

### Prerequisites

- Node.js 18+ and npm
- AWS CLI configured with appropriate permissions
- AWS CDK CLI (`npm install -g aws-cdk`)
- Plant Ranger API credentials

### 1. Clone and Install

```bash
git clone <repository-url>
cd plant-ranger-alexa-skill
npm install
```

### 2. Configure OAuth Credentials

Update the OAuth credentials in AWS Secrets Manager:

```bash
aws secretsmanager update-secret \
  --secret-id plant-ranger-oauth-credentials \
  --secret-string '{
    "clientId": "your-client-id",
    "clientSecret": "your-client-secret", 
    "authUrl": "https://api.plantranger.com/oauth/authorize",
    "tokenUrl": "https://api.plantranger.com/oauth/token",
    "apiBaseUrl": "https://api.plantranger.com/v1"
  }'
```

### 3. Deploy Infrastructure

```bash
chmod +x deploy.sh
./deploy.sh
```

### 4. Deploy with ASK CLI (Recommended)

The project is set up for deployment using the Alexa Skills Kit Command Line Interface (ASK CLI):

```bash
# First-time setup: Initialize ASK CLI
ask init

# Deploy the skill (compiles TypeScript and deploys everything)
./ask-deploy.sh

# Or manually:
ask deploy
```

**See [ASK_CLI_DEPLOYMENT.md](./ASK_CLI_DEPLOYMENT.md) for detailed instructions.**

### 5. Alternative: Manual Configuration

1. Go to [Alexa Developer Console](https://developer.amazon.com/alexa/console/ask)
2. Create a new skill named "Plant Ranger Check"
3. Upload the `skill-package/skill.json` manifest
4. Upload the `skill-package/interactionModels/custom/en-US.json` interaction model
5. Set the endpoint to your deployed Lambda ARN:
   `arn:aws:lambda:us-east-1:529123413029:function:plant-ranger-alexa-handler`

### 6. Test the Skill

- Use the Alexa Developer Console test simulator
- Test on a physical Alexa device
- Verify OAuth flow works correctly

## ğŸ”§ Configuration

### Environment Variables

The Lambda functions use these environment variables:

- `OAUTH_TOKENS_TABLE`: DynamoDB table name for token storage
- `OAUTH_SECRETS_NAME`: Secrets Manager secret name
- `LOG_LEVEL`: Logging level (INFO, DEBUG, ERROR)

### OAuth Configuration

The skill uses OAuth 2.0 Authorization Code flow:

1. User initiates plant health check
2. If no valid token exists, redirect to authorization URL
3. User authorizes the application
4. Authorization code is exchanged for access token
5. Access token is stored in DynamoDB
6. API calls are made with the access token

## ğŸ§ª Testing

### Unit Tests

```bash
npm test
```

### Integration Tests

```bash
# Test OAuth flow
curl -X POST https://your-lambda-url/oauth \
  -H "Content-Type: application/json" \
  -d '{"userId": "test-user", "refreshToken": "test-token"}'

# Test Alexa skill
# Use Alexa Developer Console test simulator
```

### Manual Testing

1. **Launch Request**: "Alexa, open Plant Ranger Check"
2. **Health Check**: "Check my plant health"
3. **Help**: "Help"
4. **Stop**: "Stop"

## ğŸ”’ Security

- OAuth tokens are encrypted and stored in DynamoDB
- API credentials stored in AWS Secrets Manager
- Least privilege IAM roles
- Input validation and sanitization
- Error handling without exposing sensitive information

## ğŸ“Š Monitoring

- CloudWatch logs for all Lambda functions
- DynamoDB metrics for token operations
- API Gateway metrics (if used)
- Custom metrics for skill usage

## ğŸ› ï¸ Development

### Local Development

```bash
# Install dependencies
npm install
cd cdk && npm install && cd ..
cd lambda && npm install && cd ..

# Build
npm run build
cd cdk && npm run build && cd ..

# Deploy
cdk deploy
```

### Adding New Intents

1. Update `alexa-skill/models/en-US.json`
2. Add intent handler in `lambda/alexa-handler.ts`
3. Add sample utterances in `alexa-skill/utterances/en-US.txt`
4. Test and deploy

## ğŸ› Troubleshooting

### Common Issues

1. **OAuth Flow Fails**
   - Check Secrets Manager credentials
   - Verify redirect URI matches
   - Check API endpoints are accessible

2. **Lambda Timeout**
   - Increase timeout in CDK stack
   - Optimize API calls
   - Check network connectivity

3. **Skill Not Responding**
   - Verify Lambda ARN in skill configuration
   - Check CloudWatch logs
   - Test Lambda function directly

### Debug Mode

Enable debug logging:

```bash
aws lambda update-function-configuration \
  --function-name PlantRangerStack-AlexaHandler-XXXXXXXXX \
  --environment Variables='{LOG_LEVEL=DEBUG}'
```

## ğŸ“ License

This project is licensed under the MIT License - see the LICENSE file for details.

## ğŸ¤ Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Add tests
5. Submit a pull request

## ğŸ“ Support

For issues and questions:
- Create an issue in the repository
- Check the troubleshooting section
- Review AWS CloudWatch logs