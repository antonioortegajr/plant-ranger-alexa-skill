# ASK CLI Deployment Guide

This guide explains how to deploy the Plant Ranger Check Alexa skill using the Alexa Skills Kit Command Line Interface (ASK CLI).

## Prerequisites

1. **ASK CLI Installed**: Already installed! (Version 2.30.7)
   ```bash
   ask --version
   ```

2. **AWS CLI Configured**: Your AWS credentials should be configured for Lambda deployment.
   ```bash
   aws configure
   ```

3. **Amazon Developer Account**: You'll need an Amazon Developer account to create and manage Alexa skills.

## Initial Setup (First Time Only)

### Step 1: Initialize ASK CLI

Run the initialization command:

```bash
ask init
```

This will:
- Open a browser for Amazon login
- Request permissions for your Amazon Developer account
- Create `.ask/config` with your credentials
- Optionally link to AWS credentials for Lambda deployment

**Note**: The `.ask/` directory is already in `.gitignore` to keep credentials secure.

### Step 2: Create a New Skill (if needed)

If you're creating a new skill for the first time:

```bash
ask new
```

Or manually create the skill in the [Alexa Developer Console](https://developer.amazon.com/alexa/console/ask), then update the `skillId` in `.ask/config`.

## Deployment

### Deploy Everything (Recommended)

Deploy both the skill manifest and Lambda code:

```bash
ask deploy
```

This command will:
1. Deploy the skill manifest from `skill-package/skill.json`
2. Deploy the interaction model from `skill-package/interactionModels/custom/en-US.json`
3. Deploy the Lambda function from `lambda/` (if configured)
4. Link the Lambda function to the skill

### Deploy Only Skill Manifest

If you only want to update the skill configuration:

```bash
ask deploy --target model
```

### Deploy Only Lambda Function

If you only want to update the Lambda code:

```bash
ask deploy --target lambda
```

## Project Structure

The project is organized for ASK CLI compatibility:

```
plant-ranger-alexa-skill/
â”œâ”€â”€ skill-package/                    # Skill manifest and models
â”‚   â”œâ”€â”€ skill.json                    # Skill manifest
â”‚   â””â”€â”€ interactionModels/
â”‚       â””â”€â”€ custom/
â”‚           â””â”€â”€ en-US.json           # Interaction model
â”œâ”€â”€ lambda/                           # Lambda function code
â”‚   â”œâ”€â”€ alexa-handler.ts
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â””â”€â”€ api-client.ts
â”‚   â””â”€â”€ package.json
â”œâ”€â”€ ask-resources.json                # ASK CLI resource mapping
â””â”€â”€ .ask/
    â””â”€â”€ config                        # ASK CLI configuration (auto-generated)
```

## Configuration Files

### `ask-resources.json`

Defines where ASK CLI should find your skill resources:

```json
{
  "askcliResourcesVersion": "2020-03-31",
  "profiles": {
    "default": {
      "skillId": "",
      "skillMetadata": {
        "src": "./skill-package"
      },
      "code": {
        "default": {
          "src": "./lambda"
        }
      }
    }
  }
}
```

**Note**: The `skillId` will be automatically populated after the first deployment.

### `.ask/config`

Contains your authentication and deployment settings. This file is auto-generated by `ask init` and should not be manually edited.

## Lambda Function Configuration

The Lambda function is already deployed and can be referenced in the skill manifest:

- **Function ARN**: `arn:aws:lambda:us-east-1:529123413029:function:plant-ranger-alexa-handler`
- **Handler**: `dist/alexa-handler.handler` (after TypeScript compilation)

### Using ASK CLI with Existing Lambda

If your Lambda is already deployed (as in this case), you can:

1. **Option A**: Let ASK CLI deploy Lambda automatically
   - ASK CLI will compile TypeScript and deploy
   - Requires proper AWS credentials in `.ask/config`

2. **Option B**: Keep Lambda separate (current approach)
   - Use `simple-deploy.sh` or AWS CLI for Lambda updates
   - Update the ARN in `skill-package/skill.json` manually
   - Use `ask deploy --target model` for skill-only updates

## Common Commands

### Validate Skill Manifest

Check if your skill manifest is valid:

```bash
ask validate
```

### Get Skill Status

Check the current status of your skill:

```bash
ask status
```

### Clone Existing Skill

If you want to pull an existing skill from the console:

```bash
ask clone --skill-id <your-skill-id>
```

### Simulate Skill

Test your skill locally (requires Node.js):

```bash
ask dialog
```

## Troubleshooting

### Authentication Issues

If you get authentication errors:

```bash
ask util upgrade
ask init  # Re-run initialization
```

### Lambda Deployment Issues

If Lambda deployment fails:

1. Check AWS credentials:
   ```bash
   aws sts get-caller-identity
   ```

2. Ensure Lambda IAM role has proper permissions

3. Compile TypeScript first:
   ```bash
   cd lambda
   npx tsc *.ts utils/*.ts --target es2020 --module commonjs --outDir dist
   ```

### Skill ID Not Found

If the skill ID is missing:

1. Get your skill ID from the [Alexa Developer Console](https://developer.amazon.com/alexa/console/ask)
2. Update `.ask/config` or set it in `ask-resources.json`

## Quick Deploy Script

For convenience, you can create a deploy script:

```bash
#!/bin/bash
# Quick deploy script

echo "ðŸ”¨ Compiling TypeScript..."
cd lambda
npx tsc *.ts utils/*.ts --target es2020 --module commonjs --outDir dist

echo "ðŸš€ Deploying with ASK CLI..."
cd ..
ask deploy

echo "âœ… Deployment complete!"
```

Save as `ask-deploy.sh` and make it executable:

```bash
chmod +x ask-deploy.sh
./ask-deploy.sh
```

## Next Steps

1. Run `ask init` to authenticate
2. Run `ask deploy` to deploy your skill
3. Test in the [Alexa Developer Console](https://developer.amazon.com/alexa/console/ask)
4. Enable your skill for testing

## Resources

- [ASK CLI Documentation](https://developer.amazon.com/en-US/docs/alexa/smapi/quick-start-alexa-skills-kit-command-line-interface.html)
- [Alexa Developer Console](https://developer.amazon.com/alexa/console/ask)
- [AWS Lambda Documentation](https://docs.aws.amazon.com/lambda/)

---

**Note**: Remember that `.ask/` contains sensitive credentials and is excluded from Git via `.gitignore`.

